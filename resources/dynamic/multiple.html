{%
Dim useList    =  (CurrentADC.PropValue("useList") = "1") ' Convert to boolean
Dim inputName
Dim inputValue
Dim caption
Dim resource
Dim i
Dim j
Dim isHeader
Dim showHeader    = CurrentADC.PropValue("showHeaders") ="1"

Dim ar = CurrentQuestion.AvailableResponses
Dim	otherIDarray As NumberArray
Dim arrOpenValues As StringArray
Dim arrOpenNames As StringArray
Dim otherID
Dim k
Dim index

For i = 1 to ar.Count
    If ar[i].isOpen = True Then
        arrOpenValues.Push(ar[i].OpenQuestion.InputValue())
        arrOpenNames.Push(ar[i].OpenQuestion.InputName())
        otherIDarray.Push(ar[i].Index)
    Endif
Next i

If useList Then
    inputName = CurrentQuestion.InputName("list") %}
    <select name="{%= inputName %}" multiple="multiple" class="multiSelect">
        {%
        Dim attrSelected
        For i = 1 To CurrentQuestion.AvailableResponses.Count
            attrSelected = On(CurrentQuestion.AvailableResponses[i].IsSelected, "selected=\"selected\"", "")
            inputValue  = CurrentQuestion.AvailableResponses[i].InputValue()
            caption     = CurrentQuestion.AvailableResponses[i].Caption
            isHeader     = CurrentQuestion.AvailableResponses[i].isHeader

            If isHeader = False or showHeader = True Then
            IF isHeader = True Then
            %}
              <optgroup label="{%= caption %}">
              {%
                Dim cr = CurrentQuestion.AvailableResponses[i].Children
                For j = 1 To cr.Count
                attrSelected = On(cr[j].IsSelected, "selected=\"selected\"", "")
              %}
              <option value="{%= cr[j].InputValue() %}" {%:= attrSelected %}>{%= cr[j].Caption %}</option>
              {% Next j %}
              </optgroup>
            {% ElseIf CurrentQuestion.AvailableResponses[i].Parent.isHeader <> True Then %}
              <option value="{%= inputValue %}" {%:= attrSelected %}>{%= caption %}</option>
            {% EndIF %}
            {% EndIF %}
        {% Next %}
    </select>
{% Else %}
    <ul>
        {%
        Dim inputId
        Dim attrChecked
		    Dim exclusive
        For i = 1 To CurrentQuestion.AvailableResponses.Count
            inputName   = CurrentQuestion.AvailableResponses[i].InputName()
            inputId     = inputName.Replace(" ", "_").Replace("M", "askia-input")
            inputValue  = CurrentQuestion.AvailableResponses[i].InputValue()
            attrChecked = On(CurrentQuestion.AvailableResponses[i].IsSelected, "checked=\"checked\"", "")
    		    exclusive = On(CurrentQuestion.AvailableResponses[i].IsExclusive, "class=\"askia-exclusive\"", "")
            caption     = CurrentQuestion.AvailableResponses[i].Caption
    		    resource	= CurrentQuestion.AvailableResponses.ResourceURL[i]
            index		= CurrentQuestion.AvailableResponses[i].index

            isHeader     = CurrentQuestion.AvailableResponses[i].isHeader
            If isHeader = False or showHeader = True Then
            IF isHeader = True Then
            %}
            <li class="responseHeader" onmousedown="return false;">{%:= caption %}</li>
            {% Else %}
            <li class="askia-response">
                <input type="checkbox" name="{%= inputName %}" id="{%= inputId %}" {%:= attrChecked %} {%:= exclusive %} />
                <label for="{%= inputId %}" class="askia-checkbox"><span hidden>Checkbox</span></label>
                <label for="{%= inputId %}" class="askia-response-label">
                    {% IF (resource <> "") Then %}
                    <img src="{%= resource %}" style="vertical-align:middle" alt="{%:= caption %}" />
                    {% EndIf %}{%:= caption %}
                </label>

                {% For k = 1 To otherIDarray.Count
                	otherID = otherIDarray[k].ToNumber()
                	IF index = otherID Then %}
                        <div style="overflow:hidden"><input type="text" aria-label="Other" class="otherText"  id="{%= CurrentQuestion.AvailableResponses[i].OpenQuestion.InputName() %}"
                          name="{%= CurrentQuestion.AvailableResponses[i].OpenQuestion.InputName() %}" data-id="{%= k %}" value="{%= CurrentQuestion.AvailableResponses[i].OpenQuestion.inputValue() %}"></div>
                        <!-- <div style="clear:both"></div> -->
                  {% EndIF %}
                {% Next %}
            </li>
            {% EndIf %}
            {% EndIf %}
        {% Next %}
    </ul>
{% EndIf %}
